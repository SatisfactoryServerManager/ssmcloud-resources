syntax = "proto3";

option go_package = "github.com/SatisfactoryServerManager/ssmcloud-resources/proto/generated";

import "models/agent.proto";
import "models/user.proto";
import "models/mod.proto";
import "models/empty.proto";
import "models/workflow.proto";
import "models/integration.proto";

service FrontendService {
    rpc CheckUserExistsOrCreate(CheckUserExistsOrCreateRequest) returns (SSMEmpty);

    rpc GetUser(GetUserRequest) returns (GetUserResponse);
    rpc GetUserLinkedAccounts(GetUserLinkedAccountsRequest) returns (GetUserLinkedAccountsResponse);
    rpc GetUserActiveAccount(GetUserActiveAccountRequest) returns (GetUserActiveAccountResponse);
    rpc GetUserActiveAccountAgents(GetUserActiveAccountAgentsRequest) returns (GetUserActiveAccountAgentsResponse);
    rpc GetUserActiveAccountUsers(GetUserActiveAccountUsersRequest) returns (GetUserActiveAccountUsersResponse);
    rpc GetUserActiveAccountAudits(GetUserActiveAccountAuditsRequest) returns (GetUserActiveAccountAuditsResponse);
    rpc GetUserActiveAccountIntegrations(GetUserActiveAccountIntegrationsRequest) returns (GetUserActiveAccountIntegrationsResponse);


    rpc GetAgent(GetAgentRequest) returns (GetAgentResponse);
    rpc GetAgentLog(GetAgentLogRequest) returns (GetAgentLogResponse);
    rpc GetAgentStats(GetAgentStatsRequest) returns (GetAgentStatsResponse);
    rpc GetAgentMods(GetAgentModsRequest) returns (GetAgentModsResponse);

    rpc CreateAgentTask(CreateAgentTaskRequest) returns (SSMEmpty);
    rpc InstallAgentMod(InstallAgentModRequest) returns (SSMEmpty);
    rpc UninstallAgentMod(UninstallAgentModRequest) returns (SSMEmpty);
    rpc UpdateAgentSettings(UpdateAgentSettingsRequest) returns (SSMEmpty);
    rpc CreateAgent(CreateAgentRequest) returns(CreateAgentResponse);
    rpc DeleteAgent(DeleteAgentRequest) returns(SSMEmpty);

    rpc SwitchActiveAccount(SwitchActiveAccountRequest) returns (SSMEmpty);
    rpc CreateAccount(CreateAccountRequest) returns (SSMEmpty);
    rpc JoinAccount(JoinAccountRequest) returns (SSMEmpty);
    rpc DeleteAccount(DeleteAccountRequest) returns(SSMEmpty);

    rpc GetAccountIntegrationEvents(GetAccountIntegrationEventsRequest) returns (GetAccountIntegrationEventsResponse);



    rpc UploadSaveFile(stream UploadSaveFileRequest) returns (UploadSaveFileResponse);

    rpc GetAgentWorkflow(GetAgentWorkflowRequest) returns(GetAgentWorkflowResponse);
    
}

message CheckUserExistsOrCreateRequest {
    string email = 1;
    string eid = 2;
    string username = 3;
}

message GetUserRequest {
    string eid = 1;
}

message GetUserResponse {
  User user = 1;
}

message GetUserLinkedAccountsRequest {
    string eid = 1;
}

message GetUserLinkedAccountsResponse {
    repeated Account linked_accounts = 1;
}

message GetUserActiveAccountRequest {
    string eid = 1;
}

message GetUserActiveAccountResponse {
    Account active_account = 1;
}

message GetUserActiveAccountAgentsRequest {
    string eid = 1;
}

message GetUserActiveAccountAgentsResponse {
    repeated Agent agents = 1;
}

message GetUserActiveAccountUsersRequest {
    string eid = 1;
}

message GetUserActiveAccountUsersResponse {
    repeated User users = 1;
}

message GetUserActiveAccountAuditsRequest {
    string eid = 1;
    string type = 2;
}

message GetUserActiveAccountAuditsResponse {
    repeated AccountAudit audits = 1;
}

message GetAgentRequest {
    string eid = 1;
    string agent_id = 2;
}

message GetAgentResponse {
    Agent agent = 1;
}

message GetAgentLogRequest {
    string eid = 1;
    string agent_id = 2;
    string type = 3;
    int32 last_index = 4;
}

message GetAgentLogResponse {
    AgentLog log = 1;
}

message GetAgentStatsRequest {
    string eid = 1;
    string agent_id = 2;
}

message GetAgentStatsResponse {
    repeated AgentStat stats = 1;
}

message CreateAgentTaskRequest{
    string eid = 1;
    string agent_id = 2;
    string action = 3;
}


message GetAgentModsRequest {
    string eid = 1;
    string agent_id = 2;
    int32 page = 3;
    string sort = 4;
    string direction = 5;
    string search = 6;
}

message GetAgentModsResponse {
    repeated Mod mods = 1;
    ModConfig agent_mod_config = 2;
    int32 total_mods = 3;
    int32 pages = 4;
}

message InstallAgentModRequest {
    string eid = 1;
    string agent_id = 2;
    string mod_reference = 3;
}

message UninstallAgentModRequest {
    string eid = 1;
    string agent_id = 2;
    string mod_reference = 3;
}

message UpdateAgentSettingsRequest{
    string eid = 1;
    string agent_id = 2;
    ServerSettings settings = 3;
}

message ServerSettings {
    string config_setting = 1;
    string update_on_start = 2;
    string auto_restart = 3;
    string auto_pause = 4;
    string auto_save_on_disconnect = 5;
    int32 auto_save_interval = 6;
    string seasonal_events = 7;
    int32 max_players = 8;
    int32 worker_threads = 9;
    string branch = 10;
    float backup_interval = 11;
    int32 backup_keep = 12;
    string mod_reference = 13;
    string mod_config = 14;
}

message UploadSaveFileRequest {
  oneof data {
    FileMetadata metadata = 1;
    bytes chunk = 2;
  }
}

message FileMetadata {
  string eid = 1;
  string agent_id = 2;
  string filename = 3;
  string content_type = 4;
}

message UploadSaveFileResponse {
  string message = 1;
}

message CreateAgentRequest {
    string eid = 1;
    string agent_name = 2;
    int32 port = 3;
    float memory = 4;
    string admin_pass = 5;
    string client_pass = 6;
    string api_key = 7;
}

message CreateAgentResponse {
    string workflow_id = 1;
}

message DeleteAgentRequest {
    string eid = 1;
    string agent_id = 2;
}

message SwitchActiveAccountRequest {
    string eid = 1;
    string account_id = 2;
}

message CreateAccountRequest {
    string eid = 1;
    string account_name = 2;
}

message JoinAccountRequest {
    string eid = 1;
    string join_code = 2;
}

message GetAgentWorkflowRequest {
    string workflow_id = 1;
}

message GetAgentWorkflowResponse {
    Workflow workflow = 1;
}

message DeleteAccountRequest {
    string eid = 1;
    string account_id = 2;
}

message GetUserActiveAccountIntegrationsRequest {
    string eid = 1;
}

message GetUserActiveAccountIntegrationsResponse {
    repeated AccountIntegration integrations = 1;
}

message GetAccountIntegrationEventsRequest {
    string integration_id = 1;
}

message GetAccountIntegrationEventsResponse {
    repeated IntegrationEvent events = 1;
}