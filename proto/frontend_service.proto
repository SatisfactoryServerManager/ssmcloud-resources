syntax = "proto3";

option go_package = "github.com/SatisfactoryServerManager/ssmcloud-resources/proto/generated";
import "models/empty.proto";
import "models/agent.proto";
import "models/user.proto";
import "models/mod.proto";

service FrontendService {
    rpc CheckUserExistsOrCreate(CheckUserExistsOrCreateRequest) returns (SSMEmpty);
    rpc GetMyUser(GetMyUserRequest) returns (GetMyUserResponse);
    rpc GetMyUserLinkedAccounts(GetMyUserLinkedAccountsRequest) returns (GetMyUserLinkedAccountsResponse);
    rpc GetMyUserActiveAccount(GetMyUserActiveAccountRequest) returns (GetMyUserActiveAccountResponse);
    rpc GetMyUserActiveAccountAgents(GetMyUserActiveAccountAgentsRequest) returns (GetMyUserActiveAccountAgentsResponse);
    rpc GetMyUserActiveAccountUsers(GetMyUserActiveAccountUsersRequest) returns (GetMyUserActiveAccountUsersResponse);
    rpc GetMyUserActiveAccountAudits(GetMyUserActiveAccountAuditsRequest) returns (GetMyUserActiveAccountAuditsResponse);
    rpc GetMyUserActiveAccountSingleAgent(GetMyUserActiveAccountSingleAgentRequest) returns (GetMyUserActiveAccountSingleAgentResponse);

    rpc GetAgentLog(GetAgentLogRequest) returns (GetAgentLogResponse);

    rpc GetAgentStats(GetAgentStatsRequest) returns (GetAgentStatsResponse);

    rpc CreateAgentTask(CreateAgentTaskRequest) returns (SSMEmpty);

    rpc GetAgentMods(GetAgentModsRequest) returns (GetAgentModsResponse);
    rpc InstallAgentMod(InstallAgentModRequest) returns (SSMEmpty);
    rpc UninstallAgentMod(UninstallAgentModRequest) returns (SSMEmpty);


    rpc UpdateAgentSettings(UpdateAgentSettingsRequest) returns (SSMEmpty);

    rpc UploadSaveFile(stream UploadSaveFileRequest) returns (UploadSaveFileResponse);
}

message CheckUserExistsOrCreateRequest {
    string email = 1;
    string eid = 2;
    string username = 3;
}

message GetMyUserRequest {
    string eid = 1;
}

message GetMyUserResponse {
  User user = 1;
}

message GetMyUserLinkedAccountsRequest {
    string eid = 1;
}

message GetMyUserLinkedAccountsResponse {
    repeated Account linked_accounts = 1;
}

message GetMyUserActiveAccountRequest {
    string eid = 1;
}

message GetMyUserActiveAccountResponse {
    Account active_account = 1;
}

message GetMyUserActiveAccountAgentsRequest {
    string eid = 1;
}

message GetMyUserActiveAccountAgentsResponse {
    repeated Agent agents = 1;
}

message GetMyUserActiveAccountUsersRequest {
    string eid = 1;
}

message GetMyUserActiveAccountUsersResponse {
    repeated User users = 1;
}

message GetMyUserActiveAccountAuditsRequest {
    string eid = 1;
}

message GetMyUserActiveAccountAuditsResponse {
    repeated AccountAudit audits = 1;
}

message GetMyUserActiveAccountSingleAgentRequest {
    string eid = 1;
    string agent_id = 2;
}

message GetMyUserActiveAccountSingleAgentResponse {
    Agent agent = 1;
}

message GetAgentLogRequest {
    string eid = 1;
    string agent_id = 2;
    string type = 3;
    int32 last_index = 4;
}

message GetAgentLogResponse {
    AgentLog log = 1;
}

message GetAgentStatsRequest {
    string eid = 1;
    string agent_id = 2;
}

message GetAgentStatsResponse {
    repeated AgentStat stats = 1;
}

message CreateAgentTaskRequest{
    string eid = 1;
    string agent_id = 2;
    string action = 3;
}


message GetAgentModsRequest {
    string eid = 1;
    string agent_id = 2;
    int32 page = 3;
    string sort = 4;
    string direction = 5;
    string search = 6;
}

message GetAgentModsResponse {
    repeated Mod mods = 1;
    ModConfig agent_mod_config = 2;
    int32 total_mods = 3;
    int32 pages = 4;
}

message InstallAgentModRequest {
    string eid = 1;
    string agent_id = 2;
    string mod_reference = 3;
}

message UninstallAgentModRequest {
    string eid = 1;
    string agent_id = 2;
    string mod_reference = 3;
}

message UpdateAgentSettingsRequest{
    string eid = 1;
    string agent_id = 2;
    ServerSettings settings = 3;
}

message ServerSettings {
    string config_setting = 1;
    string update_on_start = 2;
    string auto_restart = 3;
    string auto_pause = 4;
    string auto_save_on_disconnect = 5;
    int32 auto_save_interval = 6;
    string seasonal_events = 7;
    int32 max_players = 8;
    int32 worker_threads = 9;
    string branch = 10;
    float backup_interval = 11;
    int32 backup_keep = 12;
    string mod_reference = 13;
    string mod_config = 14;
}

message UploadSaveFileRequest {
  oneof data {
    FileMetadata metadata = 1;
    bytes chunk = 2;
  }
}

message FileMetadata {
  string eid = 1;
  string agent_id = 2;
  string filename = 3;
  string content_type = 4;
}

message UploadSaveFileResponse {
  string message = 1;
}