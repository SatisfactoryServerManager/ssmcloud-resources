syntax = "proto3";

option go_package = "github.com/SatisfactoryServerManager/ssmcloud-resources/proto/generated";
import "models/empty.proto";
import "models/agent.proto";
import "google/protobuf/timestamp.proto";

service FrontendService {
    rpc CheckUserExistsOrCreate(CheckUserExistsOrCreateRequest) returns (SSMEmpty);
    rpc GetMyUser(GetMyUserRequest) returns (GetMyUserResponse);
    rpc GetMyUserLinkedAccounts(GetMyUserLinkedAccountsRequest) returns (GetMyUserLinkedAccountsResponse);
    rpc GetMyUserActiveAccount(GetMyUserActiveAccountRequest) returns (GetMyUserActiveAccountResponse);
    rpc GetMyUserActiveAccountAgents(GetMyUserActiveAccountAgentsRequest) returns (GetMyUserActiveAccountAgentsResponse);
    rpc GetMyUserActiveAccountSingleAgent(GetMyUserActiveAccountSingleAgentRequest) returns (GetMyUserActiveAccountSingleAgentResponse);

    rpc GetAgentLog(GetAgentLogRequest) returns (GetAgentLogResponse);

    rpc GetAgentStats(GetAgentStatsRequest) returns (GetAgentStatsResponse);

    rpc CreateAgentTask(CreateAgentTaskRequest) returns (SSMEmpty);
}

message CheckUserExistsOrCreateRequest {
    string email = 1;
    string eid = 2;
    string username = 3;
}

message GetMyUserRequest {
    string eid = 1;
}

message GetMyUserResponse {
  User user = 1;
}

message GetMyUserLinkedAccountsRequest {
    string eid = 1;
}

message GetMyUserLinkedAccountsResponse {
    repeated Account linked_accounts = 1;
}

message GetMyUserActiveAccountRequest {
    string eid = 1;
}

message GetMyUserActiveAccountResponse {
    Account active_account = 1;
}

message GetMyUserActiveAccountAgentsRequest {
    string eid = 1;
}

message GetMyUserActiveAccountAgentsResponse {
    repeated Agent agents = 1;
}

message GetMyUserActiveAccountSingleAgentRequest {
    string eid = 1;
    string agent_id = 2;
}

message GetMyUserActiveAccountSingleAgentResponse {
    Agent agent = 1;
}

message GetAgentLogRequest {
    string eid = 1;
    string agent_id = 2;
    string type = 3;
    int32 last_index = 4;
}

message GetAgentLogResponse {
    AgentLog log = 1;
}

message GetAgentStatsRequest {
    string eid = 1;
    string agent_id = 2;
}

message GetAgentStatsResponse {
    repeated AgentStat stats = 1;
}

message CreateAgentTaskRequest{
    string eid = 1;
    string agent_id = 2;
    string action = 3;
}

message User {
  string id = 1;
  string external_id = 2;
  string email = 3;
  string username = 4;

  string profile_image_url = 5;

  repeated UserAPIKey api_keys = 6;

  google.protobuf.Timestamp last_active = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message UserAPIKey {
  string short_key = 1;
  string key = 2;
}

message Account {
  string id = 1;
  string account_name = 2;
  string join_code = 3;

  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;

}