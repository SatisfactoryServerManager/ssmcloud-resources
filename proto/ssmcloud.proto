syntax = "proto3";


option go_package = "github.com/SatisfactoryServerManager/ssmcloud-resources/proto";

service AgentService {
  rpc GetAgentConfig (Empty) returns (AgentConfigResponse);
  rpc UpdateAgentConfigVersionIp (AgentConfigRequest) returns (Empty);
  rpc UpdateAgentState (stream AgentStateRequest) returns (Empty);
  rpc StreamAgentTasks(Empty) returns (stream AgentTask);
}

message AgentConfig {
    int32 backupInterval = 1;
    int32 backupKeepAmount = 2;
}

message AgentServerConfig {
    int32 maxPlayers = 1;
    int32 workerThreads = 2;
    string branch = 3;
    bool updateSFOnStart = 4;
    bool autoRestart = 5;
    bool autoPause = 6;
    bool autoSaveOnDisconnect = 7;
    int32 autoSaveInterval = 8;
    bool disableSeasonalEvents = 9;
}

message AgentConfigResponse {
  AgentConfig config = 1;
  AgentServerConfig serverConfig = 2;
}

message AgentConfigRequest {
    string version = 2;
    string ip = 3;
}

message AgentStateRequest {
    bool online = 1;
    bool installed = 2;
    bool running = 3;
    float cpu = 4;
    float ram = 5;
    int64 installedSFVersion = 6;
    int64 latestSFVersion = 7;
}

message AgentTask {
  string id = 1;
  string action = 2;
  string data = 3; // serialized JSON or string
  bool completed = 4;
  int32 retries = 5;
}

message Empty {}